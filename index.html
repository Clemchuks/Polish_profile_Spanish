<!-- ==========  EXTERNAL ASSETS  ========== -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>




<!-- ==========  STYLE  ========== -->
<style>
/* --------- RESET + GLOBAL --------- */

.hft-wrapper{ 
  font-family: sans-serif;}

.hft-wrapper{
  background:#f3e6d8;
  min-height:100vh;
  display:flex;
  align-items:flex-start;
  justify-content:center;
  padding:2.5rem 1rem;
  color:#1b1b1b
}
.hft-container{width:100%;max-width:34rem;text-align:center}

/* --------- TYPOGRAPHY --------- */
.hft-title{
  font-weight:700;
  line-height:1.25;
  margin:0;
  font-size:1rem
}
@media(min-width:640px){.hft-title{font-size:1rem}}
@media(min-width:768px){.hft-title{font-size:2rem}}

.hft-title           { color:#1b1b1b; }
.hft-title-key       { color:#147191; }
.hft-step-text{
  font-size:0.5rem;
  color:#374151;
  margin:0
}

@media(min-width:640px){.hft-step-text{font-size:.8rem}}

/* --------- PROGRESS BAR --------- */
.hft-bar-shell{
  width:100%;
  height:.675rem;
  background:#e5e7eb;
  border-radius:9999px;
  margin-top:.5rem;
  overflow:hidden
}
.hft-bar{
  height:100%;
  width:0;
  background:#16a34a;
  position:relative;
  transition:width 2s ease
}
.hft-bar-percent{
  position:absolute;
  right:.6rem;
  top:50%;
  transform:translateY(-50%);
  font-size:.75rem;
  color:rgba(255,255,255,.7);
  font-weight:600;
  white-space:nowrap
}

.hft-check{color:#16a34a;font-size:1.125rem;margin-left:.5rem;display:none}

/* --------- LAYOUT HELPERS --------- */
.hft-step{display:none;margin-top:2rem;text-align:left}
.hft-flex-between{display:flex;justify-content:space-between;align-items:center}
.hft-show{display:block !important}
.hft-hidden{display:none !important}

/* --------- CTA BUTTON --------- */
.hft-cta{display:none;margin-top:3rem}
.hft-btn{
  display:flex;
  align-items:center;
  justify-content:center;
  max-width:220px;   
  margin:0 auto;
  background:#c98e4b;
  color:#fff;
  font-weight:600;
  font-size:1rem;
  padding:.75rem 1.5rem;
  border-radius:.625rem;
  text-decoration:none;
  transition:background .3s
}
.hft-btn:hover{background: #c98e4b}
.hft-btn i{margin-left:.75rem}

/* --------- POPUP --------- */
.hft-popup{
  position:fixed;
  inset:0;
  display:none;
  align-items:center;
  justify-content:center;
  background:rgba(0,0,0,.6);
  z-index:999;
  padding:1rem
}
.hft-popup-box{
  background:#fff;
  width:100%;
  max-width:22rem;
  padding:2rem;
  border-radius:.75rem;
  box-shadow:0 10px 25px rgba(0,0,0,.1);
  text-align:center
}
.hft-popup-title{
  font-size: 1.3rem;       /* sutil */
  font-weight: 500;
  color:#6b7280;           /* gris */
  margin:0 0 .5rem;
}
.hft-popup-msg{
  font-size: 1.4rem;       /* pregunta principal */
  font-weight: 500;
  color:#111827;           /* casi negro */
  line-height: 1.45;
  margin:0 0 1.25rem;
}

.hft-popup-actions{
  display:flex;
  gap:.75rem;
  flex-wrap:wrap;
  justify-content:center
}
.hft-popup-btn{
  padding:.5rem 1.25rem;
  font-size:.9375rem;
  border-radius:1rem;
  border:none;
  cursor:pointer
}
/* Mostrar ✓ al completar */
.hft-bar-percent.is-complete{
  color:#fff;
}
.hft-bar-percent.is-complete::before{
  content:"\2713";
  font-weight:700;
  font-size:1rem;
  line-height:1;
}

.hft-popup-btn.yes{background:#16a34a;color:#fff}
.hft-popup-btn.no {background:#16a34a;color:#fff}
/* ====== BRAND HEADER (TITAN) ====== */
.hft-header{
  position: sticky;         /* stays at the top on scroll */
  top: 0;
  z-index: 1000;
  background: #f3e6d8;      /* matches page background */
  border-bottom: 3px solid #c98e4b; /* same accent as CTA */
}
.hft-header-inner{
  max-width: 1200px;
  margin: 0 auto;
  padding: .6rem 1rem;
  display: flex;
  align-items: center;
  justify-content: center;  /* center the logo like in the screenshot */
}
.hft-logo{
  height: 56px;             /* responsive but controlled height */
  width: auto;
}
@media (min-width: 768px){
  .hft-logo{ height: 72px; }
}

/* Header can stay sticky but below the popup */
.hft-header{
  position: sticky;
  top: 0;
  z-index: 1000;        /* keep */
}

/* Make the popup overlay sit on top of EVERYTHING (incl. header) */
.hft-popup{
  position: fixed;
  inset: 0;
  display: none;
  align-items: center;
  justify-content: center;
  background: rgba(0,0,0,.6);
  z-index: 10000;       /* ↑ was 999 — raise above header */
  padding: 1rem;
}

</style>

<header class="hft-header" aria-label="Brand">
  <div class="hft-header-inner">
    <img
      class="hft-logo"
      src="https://assets.prd.heyflow.com/flows/4Vy6vFRkRCqdo6eN21Sj/www/assets/b7e626c7-e9e6-42b7-9698-5844bee95151/original.avif"
      alt="TITAN"
      loading="eager"
      decoding="async"
    />
  </div>
</header>

<!-- ==========  HTML  ========== -->
<div class="hft-wrapper" lang="es">
  <div class="hft-container">

    <!-- PASOS (inicialmente ocultos) -->
    <div id="step-1" class="hft-step">
      <div class="hft-flex-between">
        <p id="label-1" class="hft-step-text">Establecimiento de objetivos</p>
        <i id="check-1" class="fas fa-check hft-check"></i>
      </div>
      <div class="hft-bar-shell">
        <div id="bar-1" class="hft-bar"><span id="percent-1" class="hft-bar-percent">0%</span></div>
      </div>
    </div>

    <div id="step-2" class="hft-step">
      <div class="hft-flex-between">
        <p id="label-2" class="hft-step-text">Evaluación de respuestas sobre el estilo de vida</p>
        <i id="check-2" class="fas fa-check hft-check"></i>
      </div>
      <div class="hft-bar-shell">
        <div id="bar-2" class="hft-bar"><span id="percent-2" class="hft-bar-percent">0%</span></div>
      </div>
    </div>

    <div id="step-3" class="hft-step">
      <div class="hft-flex-between">
        <p id="label-3" class="hft-step-text">Optimización de la selección de productos</p>
        <i id="check-3" class="fas fa-check hft-check"></i>
      </div>
      <div class="hft-bar-shell">
        <div id="bar-3" class="hft-bar"><span id="percent-3" class="hft-bar-percent">0%</span></div>
      </div>
    </div>

    <!-- FINAL CTA -->
    <div id="final-button" class="hft-cta">
      <a href="https://shop.try-titan.es/main-hsp" target="_blank" rel="noopener" class="hft-btn">
        Enviar
      </a>
    </div>

  </div><!-- /.container -->
</div><!-- /.wrapper -->

<!-- POPUP -->
<div id="hft-popup" class="hft-popup" role="dialog" aria-modal="true">
  <div class="hft-popup-box">
    <h2 class="hft-popup-title"></h2>
    <p class="hft-popup-msg"></p>
    <div class="hft-popup-actions">
      <button class="hft-popup-btn no"  onclick="hftHandleResponse()">No</button>
      <button class="hft-popup-btn yes" onclick="hftHandleResponse()">Sí</button>
    </div>
  </div>
</div>

<script>
/* ==========================================================
   TRANSFORMATION PLAN – Heyflow-safe script (force-counting)
   ========================================================== */

let hftStep = 1;

const hftPopupContent = {
  1: { t: "Para continuar, por favor indica",
       m: "¿Estás decidido a detener por fin la caída del cabello?" },
  2: { t: "Para continuar, por favor indica",
       m: "¿Sabías que el estrés y la genética son dos de los mayores factores que causan la caída del cabello?" },
  3: { t: "Para continuar, por favor indica",
       m: "¿Te parece bien una rutina de cuidado del cabello más simple y eficaz?" }
};

const hftStepLabels = {
  1: { load: "Establecimiento de objetivos…",                 done: "Objetivos" },
  2: { load: "Evaluando respuestas sobre el estilo de vida…", done: "Ajuste individual" },
  3: { load: "Optimizando la selección de productos…",        done: "Esenciales seleccionados" }
};

function qs(id){ return document.getElementById(id); }

/* Show only steps up to current step */
function hftShowSteps () {
  for (let i = 1; i <= 3; i++) {
    const stepEl = qs(`step-${i}`);
    const lblEl  = qs(`label-${i}`);
    const bar    = qs(`bar-${i}`);

    if (i <= hftStep) {
      stepEl.classList.add('hft-show');
      if (bar.getAttribute('data-pct') !== '100') {
        lblEl.textContent = hftStepLabels[i].load;
      }
    } else {
      stepEl.classList.remove('hft-show');
    }
  }
}

/* Internal: set percent synchronously and record it */
function setPct(barEl, pct) {
  const pctLbl = qs(barEl.id.replace('bar', 'percent'));
  const clamped = Math.max(0, Math.min(100, pct|0));
  // disable CSS transition to avoid lag/freezing
  barEl.style.transition = 'none';
  barEl.style.width = clamped + '%';
  barEl.setAttribute('data-pct', String(clamped));
  pctLbl.style.display = '';
  pctLbl.textContent = clamped + '%';
}

/* Animate bar by +1% steps, showing every number */
function hftFillBar (barId, target, cb, stepDelayMs = 60) {
  hftShowSteps();

  const bar    = qs(barId);
  const pctLbl = qs(barId.replace('bar', 'percent'));
  const lbl    = qs(barId.replace('bar', 'label'));
  const tgt    = Math.max(0, Math.min(100, parseInt(target,10)));

  // current from data attribute (fallback to inline width/0)
  let cur = parseInt(bar.getAttribute('data-pct') || '0', 10);
  if (isNaN(cur)) {
    cur = parseInt((bar.style.width || '0').replace('%',''), 10) || 0;
  }

  // in case the bar never initialized
  setPct(bar, cur);

  function tick () {
    if (cur >= tgt) {
      if (tgt === 100) {
        lbl.textContent = hftStepLabels[hftStep].done;
        const checkIcon = qs(`check-${hftStep}`);
        if (checkIcon) checkIcon.style.display = 'inline';
      }
      if (typeof cb === 'function') setTimeout(cb, 200);
      return;
    }
    cur += 1;
    setPct(bar, cur);
    setTimeout(tick, stepDelayMs);
  }

  setTimeout(tick, stepDelayMs);
}

function hftShowPopup () {
  const pop      = qs('hft-popup');
  const { t, m } = hftPopupContent[hftStep] || {t:'', m:''};
  pop.querySelector('.hft-popup-title').textContent = t;
  pop.querySelector('.hft-popup-msg').textContent   = m;
  pop.style.display = 'flex';
}

function hftHidePopup () {
  qs('hft-popup').style.display = 'none';
}

/* After user clicks Yes/No: continue same step 51→100 (no jump) */
function hftHandleResponse () {
  hftHidePopup();

  const step = hftStep;
  hftFillBar(`bar-${step}`, 100, () => {
    hftStep++;

    if (hftStep <= 3) {
      hftShowSteps();
      // next step 0→50, then popup
      // ensure bar is reset to 0 explicitly
      const nextBar = qs(`bar-${hftStep}`);
      setPct(nextBar, parseInt(nextBar.getAttribute('data-pct')||'0',10)); // keep current
      setTimeout(() => hftFillBar(`bar-${hftStep}`, 50, hftShowPopup), 300);
    } else {
      hftShowSteps();
      setTimeout(() => { qs('final-button').style.display = 'block'; }, 300);
    }
  }, 20);
}
// ensure global for inline onclick
window.hftHandleResponse = hftHandleResponse;

/* ---------------- INIT (run once) ---------------- */
function hftRunOnce () {
  if (window.__hft_started) return;
  window.__hft_started = true;

  // Initialize all bars to 0% deterministically
  for (let i = 1; i <= 3; i++) {
    const bar = qs(`bar-${i}`);
    if (bar) setPct(bar, 0);
  }

  setTimeout(() => {
    hftShowSteps();
    // Step 1: 0→50 (no jump), then popup
    hftFillBar('bar-1', 50, () => setTimeout(hftShowPopup, 200));
  }, 400); // small, reliable delay
}

/* Standalone run */
document.addEventListener('DOMContentLoaded', () => {
  setTimeout(hftRunOnce, 50);
});

/* Heyflow multi-screen support */
const MY_SCREEN = ""; // e.g. "Transformación"
window.addEventListener('heyflow-screen-view', (e) => {
  if (!MY_SCREEN || (e.detail && e.detail.screenName === MY_SCREEN)) {
    hftRunOnce();
  }
});
</script>


